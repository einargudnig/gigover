# Vite Migration and Package Update Plan

This document outlines the tasks for migrating the React application from Create React App (CRA) to Vite, along with necessary package updates.

## Phase 1: Critical Dependency Updates

-   [x] **Upgrade Firebase (v7 to v10+)**
    -   [x] Update `firebase` package in `package.json`.
    -   [x] Refactor Firebase initialization and service usage to the v9+ modular API (`src/firebase/firebase.ts`, `src/services/FileSystemService.ts`, `src/hooks/useFirebaseAuth.ts`, `src/pages/NewLogin.tsx`, `src/firebase/firebaseTypes.ts`).
    -   [x] Test authentication and Firebase-dependent features.
-   [-] **Upgrade React Query (v3 to TanStack Query v5)**
    -   [x] Replace `react-query` with `@tanstack/react-query` in `package.json`.
    -   [x] Update `QueryClientProvider` setup in `src/index.tsx`.
    -   [x] Refactor all instances of `useQuery`, `useMutation`, and other hooks.
        -   [x] `src/mutations/useHoldResource.ts`
        -   [x] `src/mutations/useImageDot.ts`
        -   [x] `src/mutations/useRemoveProgressTab.ts`
        -   [x] `src/mutations/useReleaseResource.ts`
        -   [x] `src/mutations/useModifyProject.ts`
        -   [x] `src/mutations/useReportToCSV.ts`
        -   [x] `src/mutations/useAddDocument.ts`
        -   [x] `src/queries/useGetUserByPhoneNumber.ts`
        -   [x] `src/mutations/useDeleteDocument.ts`
        -   [x] `src/mutations/procurement/useAcceptOffer.ts`
        -   [x] `src/mutations/procurement/useInviteBidder.ts`
        -   [x] `src/mutations/procurement/useAddOffer.ts`
        -   [x] `src/mutations/procurement/useAddTenderItem.ts`
        -   [x] `src/mutations/properties/useAddStakeHolder.ts`
        -   [x] `src/mutations/properties/useAddProjectToProperty.ts`
        -   [x] `src/mutations/properties/useRemoveProjectFromProperty.ts`
        -   [x] `src/mutations/properties/useEditProperty.ts`
        -   [x] `src/mutations/procurement/useDeleteProcurement.ts`
        -   [x] `src/mutations/properties/useAddUnit.ts`
        -   [x] `src/mutations/procurement/useAddTenderDocument.ts`
        -   [x] `src/mutations/procurement/useModifyTender.ts`
        -   [x] `src/mutations/procurement/useDeleteTenderItem.ts`
        -   [x] `src/mutations/procurement/useAddOfferItems.ts`
        -   [x] `src/mutations/procurement/useModifyTenderItem.ts`
        -   [x] `src/mutations/procurement/usePublishOffer.ts`
        -   [x] `src/mutations/procurement/usePublishTender.ts`
        -   [x] `src/mutations/procurement/client-bids/useAcceptBid.ts`
        -   [x] `src/mutations/procurement/client-bids/useEditBidItem.ts`
        -   [x] `src/mutations/procurement/client-bids/useEditBid.ts`
        -   [x] `src/mutations/procurement/useRejectOffer.ts`
        -   [x] `src/mutations/procurement/useAddTenderDocumentByTenderOwner.ts`
        -   [x] `src/mutations/procurement/client-bids/useRejectBid.ts`
        -   [x] `src/mutations/procurement/client-bids/useDeleteBidItem.ts`
        -   [x] `src/mutations/properties/useRemoveStakeHolder.ts`
        -   [x] `src/mutations/properties/useAddPropertyDocument.ts`
        -   [x] `src/queries/useVerify.ts`
        -   [x] `src/mutations/useChangeUid.ts`
        -   [x] `src/mutations/useProjectFolders.ts`
    -   [x] Review TanStack Query v4 and v5 migration guides for breaking changes.
        -   **v4 Breaking Changes Noted:**
            -   Package name: `react-query` -> `@tanstack/react-query` (Already handled)
            -   Query Keys: Must be an array. (Believed to be handled, confirm during testing)
            -   `idle` State Removed: Use `fetchStatus: 'idle'`. `isInitialLoading` for first load. (Review usages of `isLoading`)
            -   `useQueries` API: Accepts `{ queries: [...] }`. (Review if `useQueries` is used)
            -   `undefined` as Cache Value: Query functions returning `undefined` are errors. (Low risk, but good to note)
            -   Network Mode: Default is `online`. If `offlineFirst` is needed, configure in `QueryClient`. (Currently not set, defaults to `online`)
            -   `onSuccess` with `setQueryData`: `onSuccess` no longer called from `setQueryData`. (No direct usage found)
        -   **v5 Breaking Changes Noted:**
            -   Single Signature: All hooks/methods use a single object argument. (Largely handled during initial refactor)
            -   Callbacks removed from `useQuery` (`onSuccess`, `onError`, `onSettled`). (No direct usage found)
            -   `cacheTime` renamed to `gcTime`. (`QueryClient` in `src/index.tsx` uses defaults, effectively `gcTime: 5 * 60 * 1000`).
            -   `isLoading` is now `isPending`. Old `isLoading` (first load) is new `isLoading` (`isPending && isFetching`). `isInitialLoading` (v4) is deprecated. (Needs careful review of `isLoading`, `isFetching` etc.)
            -   `keepPreviousData` removed. Use `placeholderData: keepPreviousData`. (No usage found)
            -   Infinite Queries:
                -   `initialPageParam` required. (Review infinite query usages)
                -   `getNextPageParam` required, manual mode removed. (Review infinite query usages)
            -   React Version: Requires React 18.0+. (Project is on React 18.2.0)
            -   Hydration: `Hydrate` component is `HydrationBoundary`, `useHydrate` removed. (No usage found)
    -   [x] Run TanStack Query codemods (v4 and v5) to catch any missed changes.
        -   v4 `replace-import-specifier.cjs`: Ran successfully, 43 files modified.
        -   v4 `key-transformation.cjs`: Ran with many errors/warnings. Seems mostly incompatible with already v5-like syntax. 1 file (`src/mutations/procurement/useAddTender.ts`) had a transformation error.
        -   v5 `remove-overloads.cjs`: Ran, 33 files modified. Many files reported as needing manual transformation. Files with "unknown error": `src/queries/procurement/useGetBidderTenders.ts`, `src/queries/procurement/useGetTenderById.ts`, `src/queries/procurement/useGetUserOffers.ts`, `src/queries/useProgressStatusList.ts`, `src/queries/procurement/client-bids/useGetBids.ts`.
    -   [ ] Systematically review `useQuery` and `useMutation` calls for adherence to v5 patterns.
        -   [ ] **Manual Review Required (from v5 codemod output - non-exhaustive list, check codemod logs for full list):**
            -   [x] `src/mutations/procurement/useInviteBidder.ts`
            -   `src/mutations/procurement/useModifyTender.ts`
            -   `src/mutations/procurement/useModifyTenderItem.ts`
            -   `src/mutations/procurement/usePublishOffer.ts`
            -   `src/mutations/procurement/client-bids/useRejectBid.ts`
            -   `src/mutations/procurement/useDeleteTenderItem.ts`
            -   `src/mutations/procurement/useRejectOffer.ts`
            -   `src/mutations/procurement/usePublishTender.ts`
            -   `src/queries/useAddFolder.ts`
            -   `src/hooks/useNotifications.ts`
            -   `src/queries/useAddTask.ts`
            -   `src/mutations/useAddDocument.ts`
            -   `src/mutations/useAddMilestone.ts`
            -   `src/queries/useAddWorker.ts`
            -   `src/queries/useGetUserByPhoneNumber.ts`
            -   `src/mutations/useChangeUid.ts`
            -   `src/mutations/useDeleteFolder.ts`
            -   `src/queries/useFolderFolders.ts`
            -   `src/mutations/useDeleteNotification.ts`
            -   `src/mutations/useDeleteTimeRecord.ts`
            -   `src/queries/useProjectDocuments.ts`
            -   `src/queries/useProjectFoldersQuery.ts`
            -   `src/mutations/useHoldResource.ts`
            -   `src/queries/useProjectList.ts`
            -   `src/mutations/useInviteUserToProject.ts`
            -   `src/queries/useProjectUsers.ts`
            -   `src/mutations/useImageDot.ts`
            -   `src/mutations/useModifyProject.ts`
            -   `src/queries/useRemoveWorker.ts`
            -   `src/mutations/useLogout.ts`
            -   `src/mutations/useModifyTimeRecord.ts`
            -   `src/mutations/useReadNotification.ts`
            -   `src/components/modals/TaskModal/NewTaskModal.tsx`
            -   `src/queries/useRemoveUser.ts`
            -   `src/mutations/useProjectFolders.ts`
            -   `src/components/NewProjectOverview.tsx`
            -   `src/mutations/useReleaseResource.ts`
            -   `src/mutations/useRemoveProgressTab.ts`
            -   `src/mutations/useModifyResource.ts`
            -   `src/queries/useTrackerStart.ts`
            -   `src/mutations/useResourceComment.ts`
            -   `src/queries/useTrackerStop.ts`
            -   `src/queries/useResources.ts`
            -   `src/queries/useVerify.ts`
            -   `src/queries/useWorkAdd.ts`
            -   `src/queries/useUpdateTask.ts`
            -   `src/queries/organisations/useGetOrganizationUsers.ts`
            -   `src/queries/organisations/useGetUserInvites.ts`
            -   `src/queries/useGetUserInfo.ts`
            -   `src/mutations/useResourceDelete.ts`
            -   `src/queries/useTaskComment.ts`
            -   `src/components/modals/TaskModal/TaskModal.tsx`
            -   `src/queries/organisations/useGetOrganizations.ts`
            -   `src/mutations/organizations/useChangeOrganizations.ts`
            -   `src/mutations/useDeleteDocument.ts`
            -   `src/mutations/organizations/useDeclineOrganizationInvite.ts`
            -   `src/queries/properties/useGetPoperties.ts`
            -   `src/mutations/organizations/useAcceptOrganizationInvite.ts`
            -   `src/mutations/organizations/useInviteUserToOrganization.ts`
            -   `src/mutations/organizations/useCreateOrganization.ts`
